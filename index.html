<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/JavaScript" src="https://underscorejs.org/underscore-min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {
            'packages': ['geochart'],
            // Note: you will need to get a mapsApiKey for more than simple.
            'mapsApiKey': 'AIzaSyDQ9N94fMjCedY84yfdWjIw3uGIuOC8ymU'
        });
        google.charts.setOnLoadCallback(drawRegionsMap);

        var states = [
            [{ v: 'US-AK', f: 'Juneau, AK' }, 1, ''],
            [{ v: 'US-AL', f: 'Montgomery, AL' }, 1, ''],
            [{ v: 'US-AZ', f: 'Phoenix, AZ' }, 0, ''],
            [{ v: 'US-AR', f: 'Little Rock, AR' }, 0, ''],
            [{ v: 'US-CA', f: 'Sacramento, CA' }, 0, ''],
            [{ v: 'US-CO', f: 'Denver, CO' }, 0, ''],
            [{ v: 'US-CT', f: 'Hartford, CT' }, 0, ''],
            [{ v: 'US-DE', f: 'Dover, DE' }, 0, ''],
            [{ v: 'US-FL', f: 'Tallahassee, FL' }, 0, ''],
            [{ v: 'US-GA', f: 'Atlanta, GA' }, 0, ''],
            [{ v: 'US-HI', f: 'Honolulu, HI' }, 0, ''],
            [{ v: 'US-ID', f: 'Boise, ID' }, 0, ''],
            [{ v: 'US-IL', f: 'Springfield, IL' }, 0, ''],
            [{ v: 'US-IN', f: 'Indianapolis, IN' }, 0, ''],
            [{ v: 'US-IA', f: 'Des Moines, IA' }, 0, ''],
            [{ v: 'US-KS', f: 'Topeka, KS' }, 0, ''],
            [{ v: 'US-KY', f: 'Frankfort, KY' }, 0, ''],
            [{ v: 'US-LA', f: 'Baton Rouge, LA' }, 0, ''],
            [{ v: 'US-ME', f: 'Augusta, ME' }, 0, ''],
            [{ v: 'US-MD', f: 'Annapolis, MD' }, 0, ''],
            [{ v: 'US-MA', f: 'Boston, MA' }, 0, ''],
            [{ v: 'US-MI', f: 'Lansing, MI' }, 0, ''],
            [{ v: 'US-MN', f: 'Saint Paul, MN' }, 0, ''],
            [{ v: 'US-MS', f: 'Jackson, MS' }, 0, ''],
            [{ v: 'US-MO', f: 'Jefferson City, MO' }, 0, ''],
            [{ v: 'US-MT', f: 'Helena, MT' }, 0, ''],
            [{ v: 'US-NE', f: 'Lincoln, NE' }, 0, ''],
            [{ v: 'US-NV', f: 'Carson City, NV' }, 0, ''],
            [{ v: 'US-NH', f: 'Concord, NH' }, 0, ''],
            [{ v: 'US-NJ', f: 'Trenton, NJ' }, 0, ''],
            [{ v: 'US-NM', f: 'Santa Fe, NM' }, 0, ''],
            [{ v: 'US-NY', f: 'Albany, NY' }, 0, ''],
            [{ v: 'US-NC', f: 'Raleigh, NC' }, 0, ''],
            [{ v: 'US-ND', f: 'Bismarck, ND' }, 0, ''],
            [{ v: 'US-OH', f: 'Columbus, OH' }, 0, ''],
            [{ v: 'US-OK', f: 'Oklahoma City, OK' }, 0, ''],
            [{ v: 'US-OR', f: 'Salem, OR' }, 0, ''],
            [{ v: 'US-PA', f: 'Harrisburg, PA' }, 0, ''],
            [{ v: 'US-RI', f: 'Providence, RI' }, 0, ''],
            [{ v: 'US-SC', f: 'Columbia, SC' }, 0, ''],
            [{ v: 'US-SD', f: 'Pierre, SD' }, 0, ''],
            [{ v: 'US-TN', f: 'Nashville, TN' }, 0, ''],
            [{ v: 'US-TX', f: 'Austin, TX' }, 0, ''],
            [{ v: 'US-UT', f: 'Salt Lake City, UT' }, 0, ''],
            [{ v: 'US-VT', f: 'Montpelier, VT' }, 0, ''],
            [{ v: 'US-VA', f: 'Richmond, VA' }, 0, ''],
            [{ v: 'US-WA', f: 'Olympia, WA' }, 0, ''],
            [{ v: 'US-WV', f: 'Charleston, WV' }, 0, ''],
            [{ v: 'US-WI', f: 'Madison, WI' }, 0, ''],
            [{ v: 'US-WY', f: 'Cheyenne, WY' }, 0, '']
        ];

        // All in fluid ounces
        var volumes = {
            'rat urinations': 0.11,
            'mouse urinations': 0.02,
            'elephant urinations': 160,
            'whale urinations': 627,
            'cat urinations': 0.9,
            'dog urinations': 1.3,
            'horse urinations': 10,
            'beer cans': 12,
            'regular mason jars': 16,
            'kitchen sinks': 958.72,
            'bath tubs': 26880,
            'washing machines': 4787.53,
            'shot glasses': 1.5,
            'eggs': 1.52,
            'stanley cups': 40,
        };

        var colors = {unvisited: '#f5f5f5', visited: '#e0b336'};
        var options = {
                region: 'US',
                displayMode: 'regions',
                resolution: 'provinces',
                enableRegionInteractivity: true,
                legend: 'none',
                colorAxis: { 
                        colors: [colors.unvisited, colors.visited]
                    },
            };

        function findStateIndex(states, value) {
            for (var i = 0; i < states.length; i++) {
                if (states[i][0].v === value) {
                    return i;
                }
            }
            return -1; // Return -1 if no match is found
        }

    function countActiveStates(states) {
        let count = 0;
        for (let i = 0; i < states.length; i++) {
            if (states[i][1] === 1) {
                count++;
            }
        }
        return count;
    }

        function toggleRegion(states, region) {
            console.log("swapping" + region);
            stateIndex = findStateIndex(states, region);
            if (findStateIndex(states, region) === -1) {
                alert('unable to find state! This totally should not happen');
                return states;
            }
            if (states[stateIndex][1] == 0)
                states[stateIndex][1] = 1
            else
                states[stateIndex][1] = 0
            return states;
        }

        function generateData(states) {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'State');
            data.addColumn('number', 'Value');
            data.addColumn({ type: 'string', role: 'tooltip' });
            data.addRows(states);
            return data;
        }

        function updateView(states) {
            activeStates = countActiveStates(states);
                totalStates = states.length;
                $('#active_states').html(activeStates);
                $('#total_states').html(totalStates);
                $('#percent').html(Math.round(activeStates / totalStates * 100) + '% of states');
                $('#amount').html(getVolume(volumes, activeStates * 8));
        }

        // https://stackoverflow.com/a/15106541/8475874
        var randomProperty = function (obj) {
};

        function getVolume(volumes, amount) {
            var volKeys = Object.keys(volumes);
            var randKey = volKeys[ volKeys.length * Math.random() << 0];
            return 'You\'ve peed ~' + amount
                + ' fluid ounces in state capitals!  That is as much as '
                + (amount / volumes[randKey]).toFixed(2) + ' ' + randKey + '.';
        }

        function drawRegionsMap() {
            var data = generateData(states);

            var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
            chart.draw(data, options);
            updateView(states);

            google.visualization.events.addListener(chart, 'regionClick', function (r) {
                console.log('You clicked on ' + r.region);
                states = toggleRegion(states, r.region);
                var newData = generateData(states);
                chart.draw(newData, options);
                updateView(states);
            });
        }
    </script>
</head>

<body>
    <div style="display:inline-block;clear:both;width:100%;">
        <div id="completion">
            <h1>CaPEEtal Tracker</h1>
            <h1 id="percent"></h1>
            <h1 id="amount"></h1>
        </div>
    </div>

    <div id="regions_div" style="width: 900px; height: 500px;"></div>
</body>

</html>